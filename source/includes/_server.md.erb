# Server

Users interact with Gifbooth *clients*. The clients, in turn, interact with the Gifbooth *server*.

The server has the following primary responsibilites:

1. Act as the *source of truth* for gif and event data.
2. Act as *liason* between clients and other services (Facebook, Twitter, ...).
3. If requested by a client, process gifs (adding shaders and overlays and the like).

<aside class="notice">
Most booth clients should be able to process gifs on their own, like the current OF client does, but sharing the image processing code with the server allows for surprisingly flexible potential client designs, like a remote booth over MMS, or adding graphics to images sent in over social media.
</aside>

<% graphviz do %>
  digraph {
    events;
    gifs;
    filters;

    events -> gifs;
    gifs -> events;
    events -> filters;
    gifs -> filters;
  }
<% end %>

## API

Clients communicate with the Gifbooth server through a consistant HTTP API.

Each API endpoint begins with the expected API version number.

## Authorization

This API requires requests to be authorized with an active API key. Send it as an HTTP header with the name 'API-Key'

```shell
curl "http://api.gifbooth.co/v1.0/"
  -H "API-Key: s0m3th1ng"
```

## todo

This API documentation below is a living document, and not currently stable.

The behaviours of some endpoints are not explicitly documented. If you're experienced with this kind of thing, you should be able to figure it out from what's here (the endpoint to update an event will behave like a combination of the endpoint for updating a gif ++ the endpoint for creating an event). I'll add more details as I work on the endpoints.

* Make gifs objects with metadata rather than just IDs
    * timestamp
    * shares?
    * event
    * filter

## GET `/gifs`

Use this endpoint to get a list of all gifs.

## GET `/gif/new-id`

```shell
curl "http://api.gifbooth.co/v1.0/gif/new-id"
  -H "API-Key: s0m3th1ng"
```

> The above command will return JSON like the following

```json
{
  "id": "abc123"
}
```

Use this endpoint to create a new gif ID.

This endpoint returns a unique identifier that can be used to upload a gif to S3.

## POST `/gif/new`

```shell
curl "http://api.gifbooth.co/v1.0/gif/upload"
  -X POST
  -H "API-Key: s0m3th1ng"
  -d '{
       "id": "abc123"
     }'
```

Use this endpoint to tell the server a new gif has been uploaded to S3.

This endpoint returns an empty document with an HTTP status code indicating the result. 200 for success, other codes for errors.

### Options

key     | value          | option
------- | -------------- | ------
id      | string         | this must be an id generated by `/gif/new`
event   | string         | optional event to add this gif to

<aside class="info">
Since filters and branding information will be stored on the server and passed to clients as needed, new events will require **no client changes**. A client can either provide an event selection (like multiple pages on a website, or a hidden menu in an ipad-app for wall) or simply use the branding from the most current event.
</aside>

## GET `/gif/:id`

Use this endpoint to find a particular gif.

TODO

## PUT `/gif/:id`

Use this endpoint to update a particular gif.

TODO

## DELETE `/gif/:id`

Use this endpoint to delete a gif.

TODO

## REDIRECT `/gif/:id/share/facebook`

```shell
open "http://api.gifbooth.co/v1.0/gif/abc123/share/facebook"
```

> The above command returns JSON like the following:

```json
[
  {
    "name": "GIFS: The Movie",
    "slug": "gtm",
    "gifs": [
      "abc123",
      "bcd234"
    ]
  },
  {
    "name": "Haunted House Party",
    "slug": "haunt",
    "gifs": [
      "cde345"
      "def456"
    ]
  }
]
```

<aside class="info">
This endpoint requires a user oauth login. It must be opened in a browser. It does not require an API key.
</aside>

Use this endpoint to post a gif to a users' Facebook.

## REDIRECT `/gif/:id/share/twitter`

```shell
open "http://api.gifbooth.co/v1.0/gif/abc123/share/twitter?message=hello"
```

<aside class="info">
This endpoint requires a user oauth login. It must be opened in a browser. It does not require an API key.
</aside>

Use this endpoint to post a gif to a users' Twitter.

### Options

key     | value          | option
------- | -------------- | ------
message | tweet text     | required tweet text

## POST `/gif/:id/share/email`

```shell
curl "http://api.gifbooth.co/v1.0/gif/abc123/share/email?to=email@example.com"
  -X POST
  -H "API-Key: s0m3th1ng"
  -d '{
       "to: "user@example.com",
       "to-name": "Stella",
       "from": "user@example.org",
       "from-name": "Marlon"
     }'
```

Use this endpoint to email a gif.

This endpoint returns an empty document with an HTTP status code indicating the result. 200 for success, other codes for errors.

### Options

key     | value          | option
------- | -------------- | ------
to      | email address  | email of recipient
to-name | string         | name of recipient
from    | email address  | email of sender
from-name | string       | name of sender
message | string         | optional message

## POST `/gif/:id/share/instagram`

```shell
curl "http://api.gifbooth.co/v1.0/gif/abc123/share/instagram?to=email@example.com"
  -H "API-Key: s0m3th1ng"
```

Use this endpoint to email a gif with instructions for posting it to Instagram.

This endpoint returns an empty document with an HTTP status code indicating the result. 200 for success, other codes for errors.

### Options

key     | value          | option
------- | -------------- | ------
to      | email address  | where to send the mp4

## POST `/gif/:id/share/mms`

```shell
curl "http://api.gifbooth.co/v1.0/gif/abc123/share/mms?to=9782541779"
  -H "API-Key: s0m3th1ng"
```

This endpoint sends a gif to the specified phone number.

This endpoint returns an empty document with an HTTP status code indicating the result. 200 for success, other codes for errors.

### Options

key     | value          | option
------- | -------------- | ------
to      | phone number   | where to send the mms
message | text           | optional message

## POST `/gif/:id/share/tumblr`

```shell
curl "http://api.gifbooth.co/v1.0/gif/abc123/share/tumblr"
  -H "API-Key: s0m3th1ng"
```

> The above command returns JSON like the following:

```json
{
  "url": "https://www.tumblr.com/widgets/share/tool?posttype=photo&tags=GIFbooth&canonicalUrl=http://gifbooth.co&content=http://gifs.gifbooth.co/675468527525040129.gif"
}
```

Use this endpoint to get a url from which a user may publish a gif to their tumblr.

## GET `/events`

```shell
curl "http://api.gifbooth.co/v1.0/events?gifs=true"
  -H "API-Key: s0m3th1ng"
```

> The above command returns JSON like the following:

```json
[
  {
    "name": "GIFS: The Movie",
    "slug": "gtm",
    "gifs": [
      "abc123",
      "bcd234"
    ],
    "filters": [
      "brandimage"
    ]
  },
  {
    "name": "Haunted House Party",
    "slug": "haunt",
    "gifs": [
      "cde345"
      "def456"
    ],
    "filters": [
      "glitch",
      "brandimage"
    ]
  }
]
```

Use this endpoint to get a list of events.

### Options

key     | value          | option
------- | -------------- | ------
gifs    | boolean        | enable or disable the listing of gifs

## POST `/event/new`

Use this endpoint to create an event.

TODO

## GET `/event/:slug`

```shell
curl "http://api.gifbooth.co/v1.0/event/gtm"
  -H "API-Key: s0m3th1ng"
```

> The above command returns JSON like the following:

```json
{
  "name": "GIFS: The Movie",
  "slug": "gtm",
  "gifs": [
    "abc123",
    "bcd234"
  ]
}
```

Use this endpoint to get information about a particular event.

## PUT `/event/:slug`

Use this endpoint to update an event.

TODO

## DELETE `/event/:slug`

Use this endpoint to delete an event.

TODO

## GET `/filters`

<%= partial "includes/speculative" %>

```shell
curl "http://api.gifbooth.co/v1.0/filters"
  -H "API-Key: s0m3th1ng"
```

> The above command returns JSON like the following:

```json
[
  {
    "type": "overlay",
    "name": "Brand Logo",
    "slug": "glitch",
    "url": "http://filters.gifbooth.co/brandlogo.png"
  },
  {
    "type": "shader",
    "name": "glitch",
    "slug": "glitch",
    "url": "http://filters.gifbooth.co/glitch.glsl"
  }
]
```

Use this endpoint to get a list of filters.

## POST `/filter/new`

<%= partial "includes/speculative" %>

```shell
curl "http://api.gifbooth.co/v1.0/filter/new"
  -H "API-Key: s0m3th1ng"
  -X POST
  -d "{
        "type": "overlay",
        "name": "Brand Logo",
        "slug": "glitch",
        "url": "http://filters.gifbooth.co/brandlogo.png"
      }"
```

Use this endpoint to create a new filter.

## GET `/filter/:slug`

<%= partial "includes/speculative" %>

```shell
curl "http://api.gifbooth.co/v1.0/filters/glitch"
  -H "API-Key: s0m3th1ng"
```

> The above command returns JSON like the following:

```json
{
  "type": "shader",
  "name": "glitch",
  "slug": "glitch",
  "url": "http://filters.gifbooth.co/glitch.glsl"
}
```

Use this endpoint to get a particular filter.

## PUT `/filter/:filter-slug`

<%= partial "includes/speculative" %>

Use this endpoint to update a filter.

TODO

## DELETE `/filter/:slug`

<%= partial "includes/speculative" %>

```shell
curl "http://api.gifbooth.co/v1.0/filter/brandlogo"
  -H "API-Key: s0m3th1ng"
  -X POST
  -d "{
        "name": "Gifs: The Movie logo"
      }"
```

Use this endpoint to update a filter.

### Options

key     | value          | option
------- | -------------- | ------
type    | string         | filter type
name    | string         | filter title
data    | ???            | depends on the type of filter, a png for overlays or glsl for a shader
