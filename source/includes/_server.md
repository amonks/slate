# Server

Users interact with Gifbooth *clients*. The clients, in turn, interact with the Gifbooth *server*. 

The server has the following primary responsibilites:

1. Act as the *source of truth* for gif and event data.
2. Act as *liason* between clients and other services (Facebook, Twitter, ...).
3. If requested by a client, process gifs (adding shaders and overlays and the like).

<aside class="notice">
Most booth clients should be able to process gifs on their own, like the current OF client does, but sharing the image processing code with the server allows for surprisingly flexible potential client designs, like a remote booth over MMS, or adding graphics to images sent in over social media.
</aside>

## API

Clients communicate with the Gifbooth server through a consistant HTTP API. 

Each API endpoint begins with the expected API version number.

Every JSON endpoint will include a `"type"` annotation.

## Authorization

This API requires requests to be authorized with an active API key. Send it as an HTTP header with the name 'API-Key'

```shell
curl "http://api.gifbooth.co/v1.0/"
  -H "API-Key: s0m3th1ng"
```

## GET/POST `/gif/new`

```shell
curl "http://api.gifbooth.co/v1.0/gif/new"
  -X POST
  -H "API-Key: s0m3th1ng"
  -d '{
       "event": "gtm"
     }'
```

> The above command will return JSON like the following

```json
{
  "type": "gif-id",
  "id": "abc123"
}
```

Use this endpoint to create a new gif ID. 

This endpoint returns a unique identifier that can be used to upload a gif to S3.

The identifier is created by hashing the event and a timestamp.

#### Options

key     | value          | option
------- | -------------- | ------
event   | event-slug     | optional identifying slug for the event this gif should be posted into. If not provided, the gif will be added to the most recent event.

<aside class="info">
Since filters and branding information will be stored on the server and passed to clients as needed, new events will require **no client changes**. A client can either provide an event selection (like multiple pages on a website, or a hidden menu in an ipad-app for wall) or simply use the branding from the most current event.
</aside>

## GET/POST `/gif/upload`

```shell
curl "http://api.gifbooth.co/v1.0/gif/upload"
  -X POST
  -H "API-Key: s0m3th1ng"
  -d '{
       "id": "abc123"
     }'
```

Use this endpoint to tell the server a new gif has been uploaded to S3.

This endpoint returns an empty document with an HTTP status code indicating the result. 200 for success, other codes for errors.

#### Options

key     | value          | option
------- | -------------- | ------
id      | gif-id         | this must be an id generated by `/gif/new`
filter  | filter-slug    | optional filter slug to be applied by the server

## REDIRECT `/gif/:id/share/facebook`

```shell
open "http://api.gifbooth.co/v1.0/gif/abc123/share/facebook"
```

> The above command returns JSON like the following:

```json
[
  {
    "type": "event",
    "name": "GIFS: The Movie",
    "slug": "gtm",
    "gifs": [
      "abc123",
      "bcd234"
    ]
  },
  {
    "type": "event",
    "name": "Haunted House Party",
    "slug": "haunt",
    "gifs": [
      "cde345"
      "def456"
    ]
  }
]
```

<aside class="info">
This endpoint requires a user oauth login. It must be opened in a browser. It does not require an API key.
</aside>

Use this endpoint to post a gif to a users' Facebook.

## REDIRECT `/gif/:id/share/twitter`

```shell
open "http://api.gifbooth.co/v1.0/gif/abc123/share/twitter?message=hello"
```

<aside class="info">
This endpoint requires a user oauth login. It must be opened in a browser. It does not require an API key.
</aside>

Use this endpoint to post a gif to a users' Twitter.

### Options

key     | value          | option
------- | -------------- | ------
message | tweet text     | required tweet text

## GET/POST `/gif/:id/share/email`

```shell
curl "http://api.gifbooth.co/v1.0/gif/abc123/share/email?to=email@example.com"
  -X POST
  -H "API-Key: s0m3th1ng"
  -d '{
       "to: "user@example.com",
       "to-name": "Stella",
       "from": "user@example.org",
       "from-name": "Marlon"
     }'
```

Use this endpoint to email a gif.

This endpoint returns an empty document with an HTTP status code indicating the result. 200 for success, other codes for errors.

#### Options

key     | value          | option
------- | -------------- | ------
to      | email address  | email of recipient
to-name | string         | name of recipient
from    | email address  | email of sender
from-name | string       | name of sender
message | string         | optional message

## GET/POST `/gif/:id/share/instagram`

```shell
curl "http://api.gifbooth.co/v1.0/gif/abc123/share/instagram?to=email@example.com"
  -H "API-Key: s0m3th1ng"
```

Use this endpoint to email a gif with instructions for posting it to Instagram.

This endpoint returns an empty document with an HTTP status code indicating the result. 200 for success, other codes for errors.

#### Options

key     | value          | option
------- | -------------- | ------
to      | email address  | where to send the mp4

## GET/POST `/gif/:id/share/mms`

```shell
curl "http://api.gifbooth.co/v1.0/gif/abc123/share/mms?to=9782541779"
  -H "API-Key: s0m3th1ng"
```

This endpoint sends a gif to the specified phone number.

This endpoint returns an empty document with an HTTP status code indicating the result. 200 for success, other codes for errors.

#### Options

key     | value          | option
------- | -------------- | ------
to      | phone number   | where to send the mms
message | text           | optional message

## GET/POST `/gif/:id/share/tumblr`

```shell
curl "http://api.gifbooth.co/v1.0/gif/abc123/share/tumblr"
  -H "API-Key: s0m3th1ng"
```

> The above command returns JSON like the following:

```json
{
  "type": "url",
  "url": "https://www.tumblr.com/widgets/share/tool?posttype=photo&tags=GIFbooth&canonicalUrl=http://gifbooth.co&content=http://gifs.gifbooth.co/675468527525040129.gif"
}
```

Use this endpoint to get a url from which a user may publish a gif to their tumblr.

## GET/POST `/events`

```shell
curl "http://api.gifbooth.co/v1.0/events?gifs=true"
  -H "API-Key: s0m3th1ng"
```

> The above command returns JSON like the following:

```json
[
  {
    "type": "event",
    "name": "GIFS: The Movie",
    "slug": "gtm",
    "gifs": [
      "abc123",
      "bcd234"
    ]
  },
  {
    "type": "event",
    "name": "Haunted House Party",
    "slug": "haunt",
    "gifs": [
      "cde345"
      "def456"
    ]
  }
]
```

Use this endpoint to get a list of events.

#### Options

key     | value          | option
------- | -------------- | ------
gifs    | boolean        | enable or disable the listing of gifs

## `/event/:slug`

```shell
curl "http://api.gifbooth.co/v1.0/event/gtm"
  -H "API-Key: s0m3th1ng"
```

> The above command returns JSON like the following:

```json
{
  "type": "event",
  "name": "GIFS: The Movie",
  "slug": "gtm",
  "gifs": [
    "abc123",
    "bcd234"
  ]
}
```

Use this endpoint to get information about a particular event.

## to be added

* `/filters` list of all
* `/filter/:slug` info: title, attribution, type, data
* `/filter/new`
* `/event/:new`
* PUT `/event/slug` (update)
* DELETE endpoints
